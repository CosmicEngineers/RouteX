'use client';

import React, { useState, useEffect } from 'react';
import { formatNumber } from '../utils/formatters';

interface Vessel {
  id: string;
  capacity_mt: number;
  charter_rate_cr_per_day: number;
}

interface Port {
  id: string;
  name: string;
  type: string;
}

interface Demand {
  port_id: string;
  demand_mt: number;
}

interface ChallengeResult {
  Source: string;
  Destination: string;
  Tanker: string;
  'Volume (MT)': number;
  'Trip Cost (Rs Cr)': number;
}

interface OptimizationResponse {
  status: string;
  optimization_results: ChallengeResult[];
  summary: {
    total_routes: number;
    total_cost_cr: number;
    total_volume_mt: number;
    total_demand_mt: number;
    satisfied_demand_mt: number;
    demand_satisfaction_percentage: number;
    unsatisfied_ports: string[];
  };
  timestamp: string;
}

export function ChallengeOutput() {
  const [results, setResults] = useState<OptimizationResponse | null>(null);
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState<string | null>(null);
  const [showInputs, setShowInputs] = useState(true);
  
  // Editable input data
  const [vessels, setVessels] = useState<Vessel[]>([
    { id: 'T1', capacity_mt: 50000, charter_rate_cr_per_day: 0.63 },
    { id: 'T2', capacity_mt: 50000, charter_rate_cr_per_day: 0.49 },
    { id: 'T3', capacity_mt: 50000, charter_rate_cr_per_day: 0.51 },
    { id: 'T4', capacity_mt: 50000, charter_rate_cr_per_day: 0.51 },
    { id: 'T5', capacity_mt: 50000, charter_rate_cr_per_day: 0.53 },
    { id: 'T6', capacity_mt: 50000, charter_rate_cr_per_day: 0.57 },
    { id: 'T7', capacity_mt: 50000, charter_rate_cr_per_day: 0.65 },
    { id: 'T8', capacity_mt: 25000, charter_rate_cr_per_day: 0.39 },
    { id: 'T9', capacity_mt: 25000, charter_rate_cr_per_day: 0.38 },
  ]);

  const [loadingPorts] = useState<Port[]>([
    { id: 'L1', name: 'Loading Port L1', type: 'loading' },
    { id: 'L2', name: 'Loading Port L2', type: 'loading' },
    { id: 'L3', name: 'Loading Port L3', type: 'loading' },
    { id: 'L4', name: 'Loading Port L4', type: 'loading' },
    { id: 'L5', name: 'Loading Port L5', type: 'loading' },
    { id: 'L6', name: 'Loading Port L6', type: 'loading' },
  ]);

  const [demands, setDemands] = useState<Demand[]>([
    { port_id: 'U1', demand_mt: 40000 },
    { port_id: 'U2', demand_mt: 135000 },
    { port_id: 'U3', demand_mt: 5000 },
    { port_id: 'U4', demand_mt: 20000 },
    { port_id: 'U5', demand_mt: 20000 },
    { port_id: 'U6', demand_mt: 20000 },
    { port_id: 'U7', demand_mt: 110000 },
    { port_id: 'U8', demand_mt: 30000 },
    { port_id: 'U9', demand_mt: 20000 },
    { port_id: 'U10', demand_mt: 20000 },
    { port_id: 'U11', demand_mt: 20000 },
  ]);

  const updateVessel = (index: number, field: keyof Vessel, value: number) => {
    const updated = [...vessels];
    updated[index] = { ...updated[index], [field]: value };
    setVessels(updated);
  };

  const updateDemand = (index: number, value: number) => {
    const updated = [...demands];
    updated[index] = { ...updated[index], demand_mt: value };
    setDemands(updated);
  };

  const runOptimization = async () => {
    setLoading(true);
    setError(null);
    
    try {
      const apiUrl = process.env.NEXT_PUBLIC_API_URL || 'http://localhost:8000';
      const response = await fetch(`${apiUrl}/api/v1/challenge/optimize`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          vessels,
          demands
        })
      });
      
      if (!response.ok) {
        throw new Error('Optimization failed');
      }
      
      const data = await response.json();
      setResults(data);
    } catch (err) {
      setError(err instanceof Error ? err.message : 'An error occurred');
    } finally {
      setLoading(false);
    }
  };

  const downloadCSV = () => {
    if (!results) return;
    
    const headers = ['Source', 'Destination', 'Tanker', 'Volume (MT)', 'Trip Cost (Rs Cr)'];
    const csvContent = [
      headers.join(','),
      ...results.optimization_results.map(row => 
        [row.Source, row.Destination, row.Tanker, row['Volume (MT)'], row['Trip Cost (Rs Cr)']].join(',')
      )
    ].join('\n');
    
    const blob = new Blob([csvContent], { type: 'text/csv' });
    const url = window.URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `hpcl_optimization_results_${new Date().toISOString().split('T')[0]}.csv`;
    a.click();
    window.URL.revokeObjectURL(url);
  };

  return (
    <div className="min-h-screen" style={{ background: "#F5F8FA" }}>
      {/* Fixed Navigation Bar */}
      <nav style={{
        position: 'fixed',
        top: 0,
        left: 0,
        right: 0,
        zIndex: 1000,
        background: 'rgba(10, 30, 60, 0.95)',
        backdropFilter: 'blur(10px)',
        borderBottom: '1px solid rgba(255, 255, 255, 0.1)',
        padding: '16px 0'
      }}>
        <div style={{ maxWidth: '1400px', margin: '0 auto', padding: '0 24px', display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
          <div style={{ fontSize: '22px', fontWeight: '700', color: '#FFFFFF', letterSpacing: '-0.02em' }}>
            HPCL RouteX
          </div>
          <div style={{ display: 'flex', gap: '32px', alignItems: 'center' }}>
            <a href="#home" style={{ color: '#E0E7EF', fontSize: '14px', fontWeight: '500', textDecoration: 'none' }}>Home</a>
            <a href="#solution" style={{ color: '#E0E7EF', fontSize: '14px', fontWeight: '500', textDecoration: 'none' }}>Solution</a>
            <a href="#optimization" style={{ color: '#E0E7EF', fontSize: '14px', fontWeight: '500', textDecoration: 'none' }}>Optimization</a>
            <a href="#analytics" style={{ color: '#E0E7EF', fontSize: '14px', fontWeight: '500', textDecoration: 'none' }}>Analytics</a>
            <button
              onClick={runOptimization}
              disabled={loading}
              style={{
                padding: '10px 24px',
                borderRadius: '8px',
                fontWeight: '600',
                fontSize: '14px',
                background: loading ? '#9CA3AF' : 'linear-gradient(135deg, #20C997, #0DCAF0)',
                color: 'white',
                border: 'none',
                cursor: loading ? 'not-allowed' : 'pointer',
                transition: 'all 0.3s ease',
                boxShadow: '0 4px 12px rgba(13, 202, 240, 0.3)'
              }}
              onMouseEnter={(e) => {
                if (!loading) {
                  e.currentTarget.style.background = 'linear-gradient(135deg, #0DCAF0, #20C997)';
                }
              }}
              onMouseLeave={(e) => {
                if (!loading) {
                  e.currentTarget.style.background = 'linear-gradient(135deg, #20C997, #0DCAF0)';
                }
              }}
            >
              {loading ? 'Running...' : 'Run Optimization'}
            </button>
          </div>
        </div>
      </nav>

      {/* Hero Section */}
      <div style={{
        position: 'relative',
        height: '550px',
        background: 'linear-gradient(135deg, #0A1E3C 0%, #0E3A5D 50%, #1A5080 100%)',
        backgroundSize: 'cover',
        backgroundPosition: 'center',
        display: 'flex',
        alignItems: 'center',
        overflow: 'hidden'
      }}>
        {/* Overlay */}
        <div style={{
          position: 'absolute',
          top: 0,
          left: 0,
          right: 0,
          bottom: 0,
          background: 'linear-gradient(rgba(10,30,60,0.85), rgba(10,30,60,0.92))',
          zIndex: 1
        }}></div>
        
        {/* Hero Content */}
        <div style={{ maxWidth: '1400px', margin: '0 auto', padding: '0 24px', position: 'relative', zIndex: 2, width: '100%' }}>
          <div style={{ maxWidth: '800px' }}>
            <div style={{ fontSize: '12px', fontWeight: '700', color: '#20C997', letterSpacing: '0.15em', marginBottom: '16px', textTransform: 'uppercase' }}>
              Enterprise Maritime Optimization
            </div>
            <h1 style={{
              fontSize: '56px',
              fontWeight: '800',
              color: '#FFFFFF',
              lineHeight: '1.1',
              marginBottom: '24px',
              letterSpacing: '-0.02em',
              fontFamily: 'Inter, system-ui, -apple-system, sans-serif'
            }}>
              Coastal Vessel Optimization Platform
            </h1>
            <p style={{
              fontSize: '20px',
              color: '#B8D4E8',
              lineHeight: '1.6',
              marginBottom: '32px',
              fontWeight: '400'
            }}>
              Minimizing bulk cargo transportation cost with data-driven routing and advanced constraint optimization algorithms.
            </p>
            <div className="flex gap-3">
            <div className="flex gap-3">
              <button
                onClick={() => setShowInputs(!showInputs)}
                style={{
                  padding: '10px 20px',
                  borderRadius: '8px',
                  fontWeight: '600',
                  fontSize: '13px',
                  background: '#FFFFFF',
                  color: '#0B5ED7',
                  border: '2px solid #0B5ED7',
                  cursor: 'pointer',
                  transition: 'all 0.3s ease'
                }}
                onMouseEnter={(e) => {
                  e.currentTarget.style.background = '#0B5ED7';
                  e.currentTarget.style.color = '#FFFFFF';
                }}
                onMouseLeave={(e) => {
                  e.currentTarget.style.background = '#FFFFFF';
                  e.currentTarget.style.color = '#0B5ED7';
                }}
              >
                {showInputs ? 'Hide Inputs' : 'Show Inputs'}
              </button>
              <button
                onClick={() => setShowInputs(!showInputs)}
                style={{
                  padding: '14px 32px',
                  borderRadius: '8px',
                  fontWeight: '600',
                  fontSize: '15px',
                  background: 'rgba(255, 255, 255, 0.12)',
                  color: 'white',
                  border: '2px solid rgba(255, 255, 255, 0.3)',
                  cursor: 'pointer',
                  transition: 'all 0.3s ease'
                }}
                onMouseEnter={(e) => {
                  e.currentTarget.style.background = 'rgba(255, 255, 255, 0.18)';
                  e.currentTarget.style.borderColor = 'rgba(255, 255, 255, 0.5)';
                }}
                onMouseLeave={(e) => {
                  e.currentTarget.style.background = 'rgba(255, 255, 255, 0.12)';
                  e.currentTarget.style.borderColor = 'rgba(255, 255, 255, 0.3)';
                }}
              >
                View Dashboard
              </button>
              <button
                onClick={runOptimization}
                disabled={loading}
                style={{
                  padding: '14px 40px',
                  borderRadius: '8px',
                  fontWeight: '700',
                  fontSize: '15px',
                  background: loading ? '#9CA3AF' : 'linear-gradient(135deg, #20C997, #0DCAF0)',
                  color: 'white',
                  border: 'none',
                  cursor: loading ? 'not-allowed' : 'pointer',
                  transition: 'all 0.3s ease',
                  boxShadow: '0 6px 20px rgba(13, 202, 240, 0.4)'
                }}
                onMouseEnter={(e) => {
                  if (!loading) {
                    e.currentTarget.style.background = 'linear-gradient(135deg, #0DCAF0, #20C997)';
                    e.currentTarget.style.transform = 'translateY(-2px)';
                    e.currentTarget.style.boxShadow = '0 8px 24px rgba(13, 202, 240, 0.5)';
                  }
                }}
                onMouseLeave={(e) => {
                  if (!loading) {
                    e.currentTarget.style.background = 'linear-gradient(135deg, #20C997, #0DCAF0)';
                    e.currentTarget.style.transform = 'translateY(0)';
                    e.currentTarget.style.boxShadow = '0 6px 20px rgba(13, 202, 240, 0.4)';
                  }
                }}
              >
                {loading ? 'Optimizing...' : 'Get Started →'}
              </button>
            </div>
          </div>
        </div>
      </div>

      {/* Main Dashboard Content */}
      <div style={{ maxWidth: '1280px', margin: '0 auto', padding: '48px 24px' }}>
        {/* Section Header */}
        <div style={{ textAlign: 'center', marginBottom: '48px' }}>
          <div style={{ fontSize: '11px', fontWeight: '700', color: '#0B5ED7', letterSpacing: '0.12em', marginBottom: '12px', textTransform: 'uppercase' }}>
            Challenge 7.1 — Optimization Dashboard
          </div>
          <h2 style={{ fontSize: '36px', fontWeight: '700', color: '#0A1E3C', marginBottom: '16px', letterSpacing: '-0.01em' }}>
            Configure & Optimize
          </h2>
          <p style={{ fontSize: '16px', color: '#4A5568', maxWidth: '640px', margin: '0 auto' }}>
            Input fleet configuration, port demands, and operational constraints to generate optimal routing solutions.
          </p>
        </div>

        {/* Content Section */}
        <div style={{ backgroundColor: '#FFFFFF', borderRadius: '16px', boxShadow: '0 4px 24px rgba(10,30,60,0.08)', padding: '32px', marginBottom: '24px' }}>
          <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '32px' }}>
            <div>
              <h3 style={{ fontSize: '18px', fontWeight: '700', color: '#0A1E3C', marginBottom: '4px' }}>Input Configuration</h3>
              <p style={{ fontSize: '13px', color: '#4A5568', marginTop: '4px', marginBottom: '0' }}>
                Configure vessel fleet, port demands, and operational parameters
              </p>
            </div>
            <div className="flex gap-3">
                onClick={runOptimization}
                disabled={loading}
                style={{
                  padding: '10px 28px',
                  borderRadius: '8px',
                  fontWeight: '600',
                  fontSize: '13px',
                  background: loading ? '#9CA3AF' : 'linear-gradient(135deg, #20C997, #0DCAF0)',
                  color: 'white',
                  border: 'none',
                  cursor: loading ? 'not-allowed' : 'pointer',
                  transition: 'all 0.3s ease',
                  boxShadow: '0 4px 12px rgba(13, 202, 240, 0.3)'
                }}
                onMouseEnter={(e) => {
                  if (!loading) {
                    e.currentTarget.style.background = 'linear-gradient(135deg, #0DCAF0, #20C997)';
                  }
                }}
                onMouseLeave={(e) => {
                  if (!loading) {
                    e.currentTarget.style.background = 'linear-gradient(135deg, #20C997, #0DCAF0)';
                  }
                }}
              >
                {loading ? (
                  <span className="flex items-center">
                    <svg className="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                      <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle>
                      <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                    Running Optimization...
                  </span>
                ) : (
                  'Run Optimization'
                )}
              </button>
            </div>
          </div>

      {/* Input Tables */}
      {showInputs && (
        <div>
          <div style={{ fontSize: '11px', letterSpacing: '0.08em', fontWeight: '700', color: '#0B5ED7', marginBottom: '20px', textTransform: 'uppercase' }}>
            STEP 1 — INPUT CONFIGURATION
          </div>
        <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
          {/* Tankers Input */}
          <div style={{ backgroundColor: '#F8FBFF', borderRadius: '12px', padding: '24px', boxShadow: '0 2px 12px rgba(0,0,0,0.06)', border: '1px solid #E6F2FF' }}>
            <h3 style={{ fontSize: '14px', fontWeight: '600', color: '#0B3C5D', marginBottom: '16px' }}>Tanker Fleet (9 Vessels)</h3>
            <div className="overflow-x-auto table-container rounded-lg">
              <table className="min-w-full divide-y divide-gray-200">
                <thead className="table-header">
                  <tr>
                    <th className="px-3 py-2 text-left text-xs font-medium uppercase">Tanker</th>
                    <th className="px-3 py-2 text-right text-xs font-medium uppercase">Capacity (MT)</th>
                    <th className="px-3 py-2 text-right text-xs font-medium uppercase">Charter Rate (₹Cr/day)</th>
                  </tr>
                </thead>
                <tbody className="divide-y divide-gray-200">
                  {vessels.map((vessel, index) => (
                    <tr key={vessel.id} className="table-row">
                      <td className="px-3 py-2 text-sm font-medium text-gray-900">{vessel.id}</td>
                      <td className="px-3 py-2 text-right">
                        <input
                          type="number"
                          value={vessel.capacity_mt}
                          onChange={(e) => updateVessel(index, 'capacity_mt', parseInt(e.target.value) || 0)}
                          className="w-24 px-2 py-1 text-sm text-right custom-input rounded"
                        />
                      </td>
              <td className="px-3 py-2 text-right">
                <input
                  type="number"
                  step="0.01"
                  value={vessel.charter_rate_cr_per_day}
                  onChange={(e) => updateVessel(index, 'charter_rate_cr_per_day', parseFloat(e.target.value) || 0)}
                  className="w-20 px-2 py-1 text-sm text-right custom-input rounded"
                />
              </td>
                    </tr>
                  ))}
                </tbody>
              </table>
            </div>
            <div className="mt-3 text-xs text-gray-500">
              <p>Total Fleet Capacity: <span className="font-semibold">{formatNumber(vessels.reduce((sum, v) => sum + v.capacity_mt, 0))} MT</span></p>
            </div>
          </div>

          {/* Demands Input */}
          <div style={{ backgroundColor: '#F8FBFF', borderRadius: '12px', padding: '24px', boxShadow: '0 2px 12px rgba(0,0,0,0.06)', border: '1px solid #E6F2FF' }}>
            <h3 style={{ fontSize: '14px', fontWeight: '600', color: '#0B3C5D', marginBottom: '16px' }}>Unloading Port Demands</h3>
            <div className="overflow-x-auto table-container rounded-lg">
              <table className="min-w-full divide-y divide-cyan-200">
                <thead className="table-header">
                  <tr>
                    <th className="px-3 py-2 text-left text-xs font-medium uppercase">Port</th>
                    <th className="px-3 py-2 text-right text-xs font-medium uppercase">Demand (MT/month)</th>
                  </tr>
                </thead>
              <tbody className="divide-y divide-gray-200">
                {demands.map((demand, index) => (
                  <tr key={demand.port_id} className="table-row">
                    <td className="px-3 py-2 text-sm font-medium text-gray-900">{demand.port_id}</td>
                    <td className="px-3 py-2 text-right">
                      <input
                        type="number"
                        value={demand.demand_mt}
                        onChange={(e) => updateDemand(index, parseInt(e.target.value) || 0)}
                        className="w-28 px-2 py-1 text-sm text-right custom-input rounded"
                      />
                    </td>
                  </tr>
                ))}
              </tbody>
              </table>
            </div>
            <div className="mt-3 text-xs text-gray-500">
              <p>Total Monthly Demand: <span className="font-semibold">{formatNumber(demands.reduce((sum, d) => sum + d.demand_mt, 0))} MT</span></p>
            </div>
          </div>

          {/* Loading Ports Info */}
          <div style={{ backgroundColor: '#F8FBFF', borderRadius: '12px', padding: '24px', boxShadow: '0 2px 12px rgba(0,0,0,0.06)', border: '1px solid #E6F2FF' }}>
            <h3 style={{ fontSize: '14px', fontWeight: '600', color: '#0B3C5D', marginBottom: '16px' }}>Loading Ports (6 Ports)</h3>
            <div className="space-y-2">
              {loadingPorts.map((port) => (
                <div key={port.id} className="flex items-center justify-between py-2 px-3 rounded" style={{ backgroundColor: '#E9FFF3' }}>
                  <span className="text-sm font-medium" style={{ color: '#0B3C5D' }}>{port.id}</span>
                  <span className="text-xs" style={{ color: '#1F4E79' }}>{port.name}</span>
                  <span className="text-xs font-semibold" style={{ color: '#198754' }}>Unlimited Supply</span>
                </div>
              ))}
            </div>
          </div>

          {/* Constraints Info */}
          <div style={{ backgroundColor: '#F8FBFF', borderRadius: '12px', padding: '24px', boxShadow: '0 2px 12px rgba(0,0,0,0.06)', border: '1px solid #E6F2FF' }}>
            <h3 style={{ fontSize: '14px', fontWeight: '600', color: '#0B3C5D', marginBottom: '16px' }}>Operational Constraints</h3>
            <div className="space-y-3">
              <div className="flex items-start">
                <div className="shrink-0 h-6 w-6 rounded-full flex items-center justify-center mt-0.5" style={{ backgroundColor: '#CDEFFF' }}>
                  <span className="text-xs font-bold" style={{ color: '#0B5ED7' }}>1</span>
                </div>
                <div className="ml-3">
                  <p className="text-sm font-medium" style={{ color: '#0B3C5D' }}>Single-port Full Loading</p>
                  <p className="text-xs" style={{ color: '#1F4E79' }}>Each tanker loads full capacity from only one port</p>
                </div>
              </div>
              <div className="flex items-start">
                <div className="shrink-0 h-6 w-6 rounded-full flex items-center justify-center mt-0.5" style={{ backgroundColor: '#CDEFFF' }}>
                  <span className="text-xs font-bold" style={{ color: '#0B5ED7' }}>2</span>
                </div>
                <div className="ml-3">
                  <p className="text-sm font-medium" style={{ color: '#0B3C5D' }}>Maximum Two-port Discharge</p>
                  <p className="text-xs" style={{ color: '#1F4E79' }}>Tanker may unload at maximum of 2 ports per trip</p>
                </div>
              </div>
        <div className="flex items-start">
          <div className="shrink-0 h-6 w-6 rounded-full flex items-center justify-center mt-0.5" style={{ backgroundColor: '#CDEFFF' }}>
            <span className="text-xs font-bold" style={{ color: '#0B5ED7' }}>3</span>
          </div>
          <div className="ml-3">
            <p className="text-sm font-medium" style={{ color: '#0B3C5D' }}>Unlimited Supply at Loading Ports</p>
            <p className="text-xs" style={{ color: '#1F4E79' }}>No supply constraints at any loading port</p>
          </div>
              </div>
              <div className="flex items-start">
                <div className="shrink-0 h-6 w-6 rounded-full flex items-center justify-center mt-0.5" style={{ backgroundColor: '#CDEFFF' }}>
                  <span className="text-xs font-bold" style={{ color: '#0B5ED7' }}>4</span>
                </div>
                <div className="ml-3">
                  <p className="text-sm font-medium" style={{ color: '#0B3C5D' }}>Full Demand Satisfaction</p>
                  <p className="text-xs" style={{ color: '#1F4E79' }}>All unloading port demands must be fully met</p>
                </div>
              </div>
            </div>
          </div>
        </div>
        </div>
      )}

      {/* Results Section */}
      </div>
      </div>

      {/* Results Section Wrapper */}
      <div style={{ backgroundColor: '#FFFFFF', borderRadius: '16px', boxShadow: '0 4px 24px rgba(10,30,60,0.08)', padding: '32px', marginTop: '32px' }}>
        <div style={{ fontSize: '11px', letterSpacing: '0.08em', fontWeight: '700', color: '#0B5ED7', marginBottom: '20px', textTransform: 'uppercase' }}>
          STEP 2 — OPTIMIZATION RESULTS
        </div>
        {error && (
          <div className="mb-6 p-4 bg-red-50 border border-red-200 rounded-lg">
            <p className="text-red-800 font-medium">Error: {error}</p>
          </div>
        )}

        {results && (
        <>
          {/* Summary Section */}
          <div className="mb-6 grid grid-cols-2 md:grid-cols-4 gap-4">
            <div className="p-4 rounded-lg border" style={{ backgroundColor: "#E6F2FF", borderColor: "#B6E6FF" }}>
              <p className="text-sm font-medium" style={{ color: "#0B5ED7" }}>Total Cost</p>
              <p className="text-2xl font-bold" style={{ color: "#0B5ED7" }}>₹{results.summary.total_cost_cr} Cr</p>
            </div>
            <div className="p-4 rounded-lg border" style={{ backgroundColor: "#E9FFF3", borderColor: "#A8E6CF" }}>
              <p className="text-sm font-medium" style={{ color: "#198754" }}>Total Routes</p>
              <p className="text-2xl font-bold" style={{ color: "#198754" }}>{results.summary.total_routes}</p>
            </div>
            <div className="p-4 rounded-lg border" style={{ backgroundColor: "#F4EDFF", borderColor: "#DCC9FF" }}>
              <p className="text-sm font-medium" style={{ color: "#6F42C1" }}>Volume Delivered</p>
              <p className="text-2xl font-bold" style={{ color: "#6F42C1" }}>{formatNumber(results.summary.total_volume_mt)} MT</p>
            </div>
            <div className="p-4 rounded-lg border" style={{ backgroundColor: "#FFF4E6", borderColor: "#FFE5B4" }}>
              <p className="text-sm font-medium" style={{ color: "#FD7E14" }}>Demand Satisfied</p>
              <p className="text-2xl font-bold" style={{ color: "#FD7E14" }}>{results.summary.demand_satisfaction_percentage}%</p>
            </div>
          </div>

          {/* Download Button */}
          <div className="mb-4 flex justify-end">
            <button
              onClick={downloadCSV}
              className="px-4 py-2 btn-primary-gradient rounded-lg font-medium transition-all flex items-center gap-2"
            >
              <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
              </svg>
              Download CSV
            </button>
          </div>

          {/* Results Table */}
          <div className="overflow-x-auto table-container rounded-lg">
            <table className="min-w-full divide-y divide-cyan-200">
              <thead className="table-header">
                <tr>
                  <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                    Source
                  </th>
                  <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                    Destination
                  </th>
                  <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                    Tanker
                  </th>
                  <th className="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">
                    Volume (MT)
                  </th>
                  <th className="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">
                    Trip Cost (Rs Cr)
                  </th>
                </tr>
              </thead>
              <tbody className="divide-y divide-gray-200">
                {results.optimization_results.map((row, index) => (
                  <tr key={index} className="table-row">
                    <td className="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">
                      {row.Source}
                    </td>
                    <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                      {row.Destination}
                    </td>
                    <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                      {row.Tanker}
                    </td>
                    <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900 text-right">
                      {formatNumber(row['Volume (MT)'])}
                    </td>
                    <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900 text-right font-medium">
                      ₹{row['Trip Cost (Rs Cr)'].toFixed(4)}
                    </td>
                  </tr>
                ))}
              </tbody>
              <tfoot className="table-header font-bold">
                <tr>
                  <td colSpan={3} className="px-6 py-4 text-sm text-gray-900">
                    TOTAL
                  </td>
                  <td className="px-6 py-4 text-sm text-gray-900 text-right">
                    {formatNumber(results.summary.total_volume_mt)} MT
                  </td>
                  <td className="px-6 py-4 text-sm text-gray-900 text-right">
                    ₹{results.summary.total_cost_cr.toFixed(2)} Cr
                  </td>
                </tr>
              </tfoot>
            </table>
          </div>
          </>
        )}

        {!results && !loading && (
          <div className="flex items-center justify-center min-h-[600px] bg-gradient-to-br from-blue-50 via-cyan-50 to-teal-50 rounded-2xl border border-blue-100">
            <div className="text-center px-8 py-12">
              <div className="relative inline-block mb-6">
                <div className="absolute inset-0 bg-gradient-to-r from-blue-400 to-cyan-400 rounded-full blur-2xl opacity-30 animate-pulse"></div>
                <div className="relative bg-gradient-to-br from-blue-500 to-cyan-500 p-8 rounded-3xl shadow-2xl">
                  <svg className="h-20 w-20 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24" strokeWidth={2}>
                    <path strokeLinecap="round" strokeLinejoin="round" d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                  </svg>
                </div>
              </div>
              <h3 className="text-3xl font-bold bg-gradient-to-r from-blue-600 to-cyan-600 bg-clip-text text-transparent mb-3">
                Ready to Optimize
              </h3>
              <p className="text-lg text-gray-600 mb-6 max-w-md mx-auto">
                Click "Run Optimization" to generate optimized coastal vessel routing results
              </p>
              <div className="grid grid-cols-3 gap-4 mt-8 max-w-lg mx-auto">
                <div className="bg-white/80 backdrop-blur-sm rounded-xl p-4 border border-blue-100 shadow-sm">
                  <div className="bg-blue-100 rounded-lg p-3 inline-block mb-2">
                    <svg className="h-8 w-8 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13 10V3L4 14h7v7l9-11h-7z" />
                    </svg>
                  </div>
                  <p className="text-xs font-semibold text-gray-700">Fast Optimization</p>
                  <p className="text-xs text-gray-500 mt-1">CP-SAT Algorithm</p>
                </div>
                <div className="bg-white/80 backdrop-blur-sm rounded-xl p-4 border border-blue-100 shadow-sm">
                  <div className="bg-green-100 rounded-lg p-3 inline-block mb-2">
                    <svg className="h-8 w-8 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                  </div>
                  <p className="text-xs font-semibold text-gray-700">Cost Minimization</p>
                  <p className="text-xs text-gray-500 mt-1">Route Efficiency</p>
                </div>
                <div className="bg-white/80 backdrop-blur-sm rounded-xl p-4 border border-blue-100 shadow-sm">
                  <div className="bg-orange-100 rounded-lg p-3 inline-block mb-2">
                    <svg className="h-8 w-8 text-orange-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                  </div>
                  <p className="text-xs font-semibold text-gray-700">Demand Coverage</p>
                  <p className="text-xs text-gray-500 mt-1">100% Satisfaction</p>
                </div>
              </div>
            </div>
          </div>
        )}
        </div>
      </div>
    </div>
  </div>
  );
}
